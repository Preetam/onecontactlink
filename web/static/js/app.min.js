var req=function(opts){opts.config=function(xhr){xhr.setRequestHeader("X-Requested-With","XMLHttpRequest")};opts.unwrapSuccess=function(response){var response=response||{};return response.data};opts.unwrapError=function(response){var response=response||{};return response.error};return m.request(opts)};var user=req({method:"GET",url:"/api/v1/user"});var contactLink=req({method:"GET",url:"/api/v1/contact_link"});var PageWrapper=function(page){this.controller=function(){};this.view=function(){return m("div[class='row']",[m("div#sidenav[class='col-sm-3 sidebar-offcanvas']",SideNav),"",m("div[class='col-sm-9']",page)])}};var HomePage={view:function(){var userInfo=user();var contactLinkAddr=contactLink();if(!userInfo||!userInfo.name){window.location="/login"}return m("div",[m("h3","Profile"),m("p",[m("strong","Main email address:"),m("span"," "+userInfo.mainEmail)]),m("p",[m("strong","OneContactLink:"),m("span"," "),m("a",{href:contactLinkAddr},contactLinkAddr)])])}};var EmailsPage={view:function(){return EmailWidget}};var TopNav={view:function(){return[m("li[class='nav-item']",m("a.nav-link[href='/']","Home")),m("li[class='nav-item']",m("a.nav-link[href='/']",{config:m.route},"Manage")),m("li[class='nav-item']",m("a.nav-link[href='/app/logout']","Logout"))]}};var SideNav={view:function(){return m("div",[btn("Home","/"),btn("Emails","/emails")]);function btn(name,route){var isCurrent=m.route()===route;var click=function(){m.route(route)};return m("a",{href:route,class:"list-group-item"+(isCurrent?" active":""),config:m.route},name)}}};m.route.mode="hash";m.mount(document.querySelector("#topnav"),TopNav);m.route(document.querySelector("#app"),"/",{"/":new PageWrapper(HomePage),"/emails":new PageWrapper(EmailsPage)});var Email=function(data){data=data||{};this.id=m.prop(data.id||0);this.address=m.prop(data.address||"");this.user=m.prop(data.user||"");this.status=m.prop(data.status||0);this.created=m.prop(data.created||0);this.updated=m.prop(data.updated||0);this.deleted=m.prop(data.deleted||0)};Email.list=function(data){return req({method:"GET",url:"/api/v1/emails",type:Email})};Email.activate=function(email){return req({method:"POST",url:"/api/v1/emails/"+email.address()+"/send_activation",data:email})};var EmailWidget={controller:function update(){this.emails=Email.list();this.activate=function(email){Email.activate(email).then(update.bind(this))}.bind(this)},view:function(ctrl){return m("div.table-responsive",[m.component(EmailList,{emails:ctrl.emails,activate:ctrl.activate})])}};var EmailListComponent=function(email,activate){this.controller=function(){this.email=email;this.activate=activate};this.view=function(ctrl){var status=ctrl.email.status();var mainEmail=user().mainEmail===ctrl.email.address();switch(status){case 2:status="Active";break;case 1:status="Pending Activation";break;case 0:status=m("button",{class:"btn btn-sm btn-primary",onclick:ctrl.activate.bind(this,ctrl.email)},"Activate");break}return m("tr",[m("td",m("span",ctrl.email.address())),m("td",status),m("td",[mainEmail?"":m("button",{class:"btn btn-sm btn-primary"},"Make primary")," ",m("button",{class:"btn btn-sm btn-danger",disabled:true},"Remove")])])}};var EmailList={view:function(ctrl,args){return m("table.table",[m("tr",[m("th","Address"),m("th","Status"),m("th","Manage")]),args.emails().map(function(email){return new EmailListComponent(email,args.activate)})])}};